# MySQL索引详解

### 一. 索引的作用

索引的作用：**提高数据查询的效率**。如果没有索引，每次查询数据都需要扫描全表。

### 二. 索引的常见模型

1. 哈希表：以key-value的形式保存数据。
   1. 优点：查询速度很快 O(1)
   2. 缺点：只适用于等值查询的场景，无法进行模糊查询和范围查询。
2. 有序数组
   1. 优点：采用二分查找，等值查询和范围查询的效率都比较高O(logn)
   2. 缺点：插入或者更新数据时，需要移动元素，效率很低。因此仅适用于静态存储引擎(数据几乎不会改变)
3. B+树

### 三. InnoDB的索引模型

1. **每个索引在InnoDB里面都对应一颗B+树**
2. **主键索引的叶子节点存放的是整行数据。主键索引也被成为聚簇索引。**
3. **非主键索引的叶子节点存放的是主键的值。非主键索引也被成为二级索引。**
4. 基于主键查询时，只需要搜索主键所在的索引B+树即可。
5. 基于非主键查询时，需要首先搜索非主键索引树，再搜索主键索引树。这个过程称为**回表**。因此，查询时尽量使用主键索引，可以减少一次查询。

### 四. 为什么推荐使用自增主键

1. 基于自增主键，每次插入主键时都是在B+树种递增插入——每次插入一条数据，都是追加操作，不涉及到移动其他记录，也不会触发叶子节点的**分裂**。
2. 使用自增主键，一般为int(4字节)或bigint(8字节)，所占空间较小。
3. 如果没有显示自增主键，InnoDB会选择一个int型或bigint型的unique_key作为主键。如果找不到unique_key，则会为该表自动生成一个自增主键。

### 五. 覆盖索引

1. 查询时，尽量让索引字段覆盖查询需求，称为覆盖索引。
2. 由于覆盖索引可以减少树的搜索次数，显著提升查询性能，所以使用覆盖索引是一个常用的性能优化手段。

### 六. 最左前缀原则

1. 最左前缀：可以是联合索引的最左 N 个字段，也可以是字符串的最左M个字符

### 七. 索引下推

MySQL 5.6引入了索引下推优化，可以在索引遍历过程中，对索引中包含的字段先做判断，直接过滤掉不满足条件的记录，减少回表次数。

### 八. 重建索引

索引可能因为删除，或者页分裂等原因，导致数据页有空洞，重建索引的过程会创建一个新的索引，把数据按顺序插入，这样页面的利用率最高，也就是索引更紧凑、更省空间。

但是删除主键或者创建主键的操作，会将整个表重建，要慎重。