# 并发编程

### 一. 基本概念

1. 进程 VS 线程
   1. 进程：**进程是操作系统进行资源分配的最小单位。**  多个进程之间互相独立。
   2. 线程：**线程是CPU进行调度的最小单位。**线程必须依赖于进程存在。一个进程中的所有线程共享该进程的资源(包括CPU、内存空间、磁盘IO等)。
2. 超线程技术：可以使核心数与线程数形成1:2的关系。
3. CPU时间片轮转机制(RR调度)
4. 并行 VS 并发

### 二. 并发编程的优缺点

1. 优点
   1. 提高CPU利用率
   2. 提高响应时间
   3. 异步化 
2. 缺点
   1. 加大开发难度
   2. 引入上下文切换
   3. 可能带来各种问题(线程安全问题、死锁、饥饿等)

### 三. 线程的基本操作

1. 启动与终止
   1. 不要使用stop()、suspend()、resume()等已被废弃的方法。已stop()为例，它会强制终止线程，可能导致有些资源未被正确释放。
2. 线程中断
   1. 通过interrupt()方法，将线程中断标志位置位，线程会响应中断
3. 线程的按顺序执行：join()方法
4. 线程优先级
5. 守护线程

### 四. 锁

1. synchronized：对象锁
2. volatile：保证可见性、有序性。**适用于一写多读的场景。**
3. ThreadLocal：Spring在事务管理中使用ThreadLocal，**实现当前线程与数据库连接的绑定**。
   1. 引申：WeakReference
   2. 引申：ThreadLocal的内存泄漏问题
   3. 引申：ThreadLocal的线程不安全问题

### 五. 线程间的协作

1. wait/notify

2. 等待/通知标准范式

3. ```java
   //等待线程
   synchronized(lock){
     while (条件不满足){
       lock.wait();	//线程在阻塞前会释放持有的锁
     }
     //执行业务逻辑
   }
   
   //通知线程
   synchronized(lock){
     //条件满足
     lock.notifyAll();
   }
   
   ```

   